---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import VideoSection from '../components/VideoSection.astro';
import AlgorithmExplainer from '../components/AlgorithmExplainer.astro';
import SecretSantaApp from '../components/SecretSantaApp';
import Credits from '../components/Credits.astro';
import FAQ from '../components/FAQ.astro';
import Footer from '../components/Footer.astro';
import SnowEffect from '../components/SnowEffect';
import DarkModeToggle from '../components/DarkModeToggle';
import '../styles/secret-santa-app.css';
---

<Layout title="The Secretest Santa - Cryptographic Gift Exchange">
  <!-- Background Effects -->
  <SnowEffect client:load />

  <!-- Dark Mode Toggle -->
  <DarkModeToggle client:load />

  <!-- Skip to main content link (accessibility) -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Main Content -->
  <main id="main-content">
    <Hero />

    <!-- Video Section -->
    <VideoSection />

    <!-- Algorithm Explanation -->
    <AlgorithmExplainer />

    <!-- Interactive Secret Santa App -->
    <SecretSantaApp client:visible />

    <!-- FAQ Section -->
    <FAQ />

    <!-- Credits Section -->
    <Credits />
  </main>

  <!-- Footer -->
  <Footer />

  <!-- Scroll Animations Script -->
  <script>
    /**
     * Scroll animations using Intersection Observer
     * Respects prefers-reduced-motion
     */
    (function () {
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if (prefersReducedMotion) return;

      function initScrollAnimations() {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px',
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
            }
          });
        }, observerOptions);

        // Observe all elements with fade-in class
        const elementsToAnimate = document.querySelectorAll('.fade-in');
        elementsToAnimate.forEach((el) => observer.observe(el));
      }

      // Wait for DOM to be ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initScrollAnimations);
      } else {
        initScrollAnimations();
      }
    })();
  </script>
</Layout>

<style>
  main {
    position: relative;
    z-index: 2;
  }

  section {
    scroll-margin-top: 2rem;
  }

  a {
    color: var(--color-pine-green);
    text-decoration: underline;
  }

  a:hover {
    color: var(--color-burgundy);
  }

  /* Skip link for accessibility */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--color-burgundy);
    color: white;
    padding: 8px 16px;
    text-decoration: none;
    z-index: 10000;
    border-radius: 0 0 4px 0;
  }

  .skip-link:focus {
    top: 0;
  }
</style>
