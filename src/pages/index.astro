---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import VideoSection from '../components/VideoSection.astro';
import AlgorithmExplainer from '../components/AlgorithmExplainer.astro';
import SecretSantaApp from '../components/SecretSantaApp';
import SnowEffect from '../components/SnowEffect';
import DarkModeToggle from '../components/DarkModeToggle';
import '../styles/secret-santa-app.css';
---

<Layout title="The Secretest Santa - Cryptographic Gift Exchange">
  <!-- Background Effects -->
  <SnowEffect client:load />

  <!-- Dark Mode Toggle -->
  <DarkModeToggle client:load />

  <!-- Main Content -->
  <main>
    <Hero />

    <!-- Video Section -->
    <VideoSection />

    <!-- Algorithm Explanation -->
    <AlgorithmExplainer />

    <!-- Interactive Secret Santa App -->
    <SecretSantaApp client:visible />

    <!-- Credits Section -->
    <section id="credits" class="container" style="padding: 4rem 1rem;">
      <div class="text-center">
        <h2>Credits</h2>
        <p>
          Inspired by <a
            href="https://www.youtube.com/watch?v=4pG8_bWpmaE"
            target="_blank"
            rel="noopener noreferrer">Tom 7's Secretest Santa 2025</a
          >
        </p>
        <p style="margin-top: 1rem; opacity: 0.8; font-size: 0.9rem;">
          All data stays in your browser. Nothing is sent to any server.
        </p>
      </div>
    </section>
  </main>

  <!-- Scroll Animations Script -->
  <script>
    /**
     * Scroll animations using Intersection Observer
     * Respects prefers-reduced-motion
     */
    (function () {
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if (prefersReducedMotion) return;

      function initScrollAnimations() {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px',
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
            }
          });
        }, observerOptions);

        // Observe all elements with fade-in class
        const elementsToAnimate = document.querySelectorAll('.fade-in');
        elementsToAnimate.forEach((el) => observer.observe(el));
      }

      // Wait for DOM to be ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initScrollAnimations);
      } else {
        initScrollAnimations();
      }
    })();
  </script>
</Layout>

<style>
  main {
    position: relative;
    z-index: 2;
  }

  section {
    scroll-margin-top: 2rem;
  }

  a {
    color: var(--color-pine-green);
    text-decoration: underline;
  }

  a:hover {
    color: var(--color-burgundy);
  }
</style>
